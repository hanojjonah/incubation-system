(self.__LOADABLE_LOADED_CHUNKS__=self.__LOADABLE_LOADED_CHUNKS__||[]).push([[97687,16142],{567450:(t,e,n)=>{function a(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}n.d(e,{Z:()=>o});const i=new class{constructor(){a(this,"onResumeListeners",[]),a(this,"onPauseListeners",[]),a(this,"inExp",!1),a(this,"windowInFocus",!0)}setExperiment(t=!1){this.inExp=t}onSessionResume(t){return this.onResumeListeners.push(t),this}onSessionPause(t){return this.onPauseListeners.push(t),this}removeResumeListener(t){this.onResumeListeners.filter((e=>e!==t))}removePauseListener(t){this.onPauseListeners=this.onPauseListeners.filter((e=>e!==t))}getAppState(){return this.windowInFocus?0:void 0}},r=t=>{if(t.isHidden){const{reason:e}=t;i.windowInFocus=!1,i.onPauseListeners.forEach((t=>t(e)))}else i.windowInFocus=!0,i.onResumeListeners.forEach((t=>t()))};setTimeout((()=>{window.addEventListener("beforeunload",(()=>r({isHidden:!0,reason:"beforeunload"}))),window.addEventListener("focus",(()=>r({isHidden:!1}))),window.addEventListener("blur",(()=>r({isHidden:!0,reason:"blur"}))),window.addEventListener("pageshow",(()=>r({isHidden:!1}))),window.addEventListener("pagehide",(()=>r({isHidden:!0,reason:"pagehide"}))),void 0!==document.hidden?document.addEventListener("visibilitychange",(()=>r(document.hidden?{isHidden:!0,reason:"visibilitychange"}:{isHidden:!1})),!1):void 0!==document.webkitHidden&&document.addEventListener("webkitvisibilitychange",(()=>r(document.webkitHidden?{isHidden:!0,reason:"visibilitychange"}:{isHidden:!1})),!1)}),0);const o=i},42447:(t,e,n)=>{n.d(e,{Z:()=>K});var a=n(667294),i=n(567450),r=n(226464),o=n(383434),s=n(790348),c=n(543059),d=n(198462),p=n(276602),m=n(638089),l=n(860273),u=n(453821),g=n(607150);const T=({constraintMap:t,initialNavTiming:e,annotations:n})=>({...n,...(0,g.jh)("constraint_",t),...(0,g.jh)("mark_",(0,c.gQ)()),...(0,g.jh)("browser_",{...e?(0,g.D3)(e):{},...(0,g.rX)()})});var f=n(505771),y=n(156381),v=n(358864);const A=(t,e)=>{const{firstInputDelay:n}=(0,y.v2)();return[...t.map((t=>(0,f.Z)(t,e))).filter(Boolean),...n?[{name:"fid",id:(0,v.Z)(),parentId:e,startTime:n.startTime,endTime:n.endTime,annotationMap:{},binaryAnnotationMap:{}}]:[]]};var h=n(172071),S=n(435851);const _=({eventPrefix:t,endTime:e,tags:n,resourceArr:a,resourceType:i="allResources"})=>{const r=a.length;if(r>0&&"object"==typeof a[0]&&!Array.isArray(a[0])){const o=[...a].sort(((t,e)=>t.fetchStart-e.fetchStart)),s=[...a].sort(((t,e)=>t.responseEnd-e.responseEnd));let c=1;const d=e/5;let p=0;for(;c<=5;){let e=0;for(;p<=r-1&&o[p].fetchStart<=d*c;)p+=1,e+=1;h.Z.gauge(`${t}.tags.${i}.fetchStartInterval${c}of5`,e,.2,n),h.Z.gauge(`${t}.${i}.fetchStartInterval${c}of5`,e,.2),c+=1}const m={zeroPercentInFlight:o[0].fetchStart,twentyFivePercentInFlight:o[Math.floor(r/4)].fetchStart,fiftyPercentInFlight:o[2*Math.floor(r/4)].fetchStart,seventyFivePercentInFlight:o[3*Math.floor(r/4)].fetchStart,hundredPercentInFlight:o[r-1].fetchStart,twentyFivePercentComplete:s[Math.floor(r/4)].responseEnd,fiftyPercentComplete:s[2*Math.floor(r/4)].responseEnd,seventyFivePercentComplete:s[3*Math.floor(r/4)].responseEnd,hundredPercentComplete:s[r-1].responseEnd};for(const e in m)m[e]&&(h.Z.timing(`${t}.tags.${i}.${e}`,m[e],.2,n),h.Z.timing(`${t}.${i}.${e}`,m[e],.2))}},E=({annotateExperiments:t,endTime:e,entries:n,metricId:a,pwtStaticContext:i})=>{const r=`${(0,S.Z)(i)}.${a.surface}`,o=[r];t&&t.forEach((t=>{const e=i.getExperimentGroup(t)||"null";o.push(`${r}.${t}.${e}`)}));const s={lcpTimingBucket:(t=>{let e;return e=t<=2500?"Good":t>2500&&t<=4e3?"Needs Improvement":"Poor",e})((0,y.Bn)())||"unknown",isAuthenticated:i.isAuthenticated,navigationType:a.navigationType},c=Array.from(n.filter((t=>"number"==typeof t.encodedBodySize&&t.encodedBodySize>=1e4&&t.responseEnd<=e))),d=[],p=[],m=[],l=[],u=[];c.forEach((t=>{"img"===t.initiatorType?d.push(t):"css"===t.initiatorType?p.push(t):"script"===t.initiatorType?m.push(t):"xmlhttprequest"===t.initiatorType?l.push(t):"link"===t.initiatorType&&t.name.includes("i.pinimg.com")&&u.push(t)})),o.forEach((t=>{_({eventPrefix:t,endTime:e,tags:s,resourceArr:c}),_({eventPrefix:t,endTime:e,tags:s,resourceArr:d,resourceType:"image"}),_({eventPrefix:t,endTime:e,tags:s,resourceArr:p,resourceType:"css"}),_({eventPrefix:t,endTime:e,tags:s,resourceArr:m,resourceType:"scripts"}),_({eventPrefix:t,endTime:e,tags:s,resourceArr:l,resourceType:"xhr"}),_({eventPrefix:t,endTime:e,tags:s,resourceArr:u,resourceType:"preloadedImage"})}))};var I=n(22773);const w=({annotateExperiments:t,annotations:e,binaryAnnotations:n,constraintMap:a,endTime:i,imageTimings:r,metricId:o,pwtStaticContext:s,startTime:c,traceId:d,spans:p})=>{const g=(0,I.Cg)();let f;"initial_app_load"===o.navigationType&&(f=(0,l.Z)());const y=r.map((({name:t})=>t)),v=g.map((t=>(0,u.p)(t,y))).filter((({timing:t})=>!(({startTime:t,responseEnd:e},n)=>t>n.endTime||!!e&&e<n.startTime||t<n.startTime-100)(t,{startTime:c,endTime:i})));return"board"!==o.surface&&"pin_closeup"!==o.surface||E({annotateExperiments:t,endTime:i,entries:g,metricId:o,pwtStaticContext:s}),{type:"COMPLETE",traceId:d,startTime:c,endTime:i,spans:A(v,d).concat(p),annotationMap:T({constraintMap:a,initialNavTiming:f,annotations:e}),binaryAnnotationMap:(0,m.rA)({annotateExperiments:t,binaryAnnotations:n,entries:g,metricId:o,performanceResources:v,pwtEndTime:i,pwtStaticContext:s})}};let C=!1;const M=(t,e)=>t&&e?C?((0,s.H)("duplicated_initial_app_load_surface_pwt"),(0,v.Z)()):(C=!0,e):(0,v.Z)();var N=n(558775),b=n(317672);const L=t=>{const e=performance.getEntriesByType("resource").filter((t=>t.name.includes("i.pinimg"))).reduce(((t,e)=>{const n=e.name.replace(".jpg","").split("/");return{[n[n.length-1]]:{downloadSize:e.name.split("/")[3].split("x")[0]},...t}}),{});[...Array.from(document.getElementsByTagName("img")).map((t=>{const n=t.src.replace(".jpg","").split("/"),a=n[n.length-1];if(e[a]){var i;const n=(null===(i=(0,b.rZ)(t))||void 0===i?void 0:i.width)||1,r=e[a].downloadSize;return{fileName:a,renderedSize:n,downloadedSize:r,ratio:r/n}}return{fileName:a,renderedSize:1,downloadedSize:1,ratio:1}})),...Array.from(document.querySelectorAll('div[role="img"]')).map((t=>{const n=t.style.backgroundImage.split('"')[1].replace(".jpg","").split("/"),a=n[n.length-1];if(e[a]&&t instanceof HTMLDivElement){var i;const n=(null===(i=(0,b.rZ)(t))||void 0===i?void 0:i.width)||1,r=e[a].downloadSize;return{fileName:a,renderedSize:n,downloadedSize:r,ratio:r/n}}return{fileName:a,renderedSize:1,downloadedSize:1,ratio:1}}))].forEach((e=>{const{ratio:n,fileName:a,downloadedSize:i}=e;e.ratio>1.05&&(0,s.A9)(`checkImageRatio.${t}`,{count:Math.round(10*n)/10,tags:{fileName:`${i}_${a}`}})}))};var P=n(985271);const R=(t,e)=>{const n=(0,a.useRef)(e);return{getState:()=>n.current,dispatch:e=>{n.current=t(n.current,e)}}};var x=n(785893);const O=["initial_app_load","client_route_push"],$=(0,o.XV)("PwtSurface"),Z="NavigationComplete",B="VisuallyComplete",H=(t,e)=>{t.isSampled&&(0,N.Z)({metricId:t.metricConfig.metricId,pwtStaticContext:t.metricConfig.pwtStaticContext,result:{type:"ABORT",reason:e}})},D=t=>{if(t.metricConfig.constraints.every((e=>t.constraintMap[e]))){const e=Math.max(...t.metricConfig.constraints.map((e=>t.constraintMap[e])));return((t,e)=>{var n;const{metricConfig:{metricId:a,pwtStaticContext:i,annotateExperiments:o},annotations:d,binaryAnnotations:p,constraintMap:m,startTime:l,imageTimings:u,isSampled:g,spans:T}=t;(0,c.L8)(`PWT_Complete_${(0,r.KJ)(a)}`);const f=M("initial_app_load"===a.navigationType,null===(n=i.serverData)||void 0===n?void 0:n.trace_id),y=w({annotateExperiments:o,annotations:d,binaryAnnotations:p,constraintMap:m,endTime:e,imageTimings:u,metricId:a,pwtStaticContext:i,startTime:l,traceId:f,spans:T});g&&(0,N.Z)({metricId:a,pwtStaticContext:i,result:y});try{L(String(y.binaryAnnotationMap["metricId.surface"].value))}catch(v){(0,s.H)("image_ratio_check_error",{error:v})}return{...t,result:y,status:"DONE"}})(t,e)}return t},z=(t,e)=>{const{constraint:n,time:a}=e,i=(0,r.KJ)(t.metricConfig.metricId);return P.Z?t.metricConfig.constraints.find((t=>t===n))?t.constraintMap[n]?($(`constraint "${n}" is already complete.`),(0,s.H)("duplicated_constraint_complete",{constraint:n,action:i}),t):($(`marking constraint "${n}" as complete`),(0,c.ZP)(`constraint_${n}_is_complete`),D({...t,constraintMap:{...t.constraintMap,[n]:a||P.Z.now()}})):($(`marked constraint "${n}" is not a required constraint.`),t):((0,s.H)("missing_window_performance",{action:i}),t)},U=(t,e)=>{if($("dispatch action",e),"INIT_ROUTE"===e.type)return((t,e)=>{const{metricConfig:n,startTime:a,isSampled:i}=e;if("TIMING"===t.status&&a!==t.startTime&&H(t,"routeUpdatedOnSameSurface"),!n)return{status:"DISABLED",metricConfig:null};const o=(0,r.KJ)(n.metricId);return"TIMING"===t.status&&t.startTime===a&&t.constraintMap[Z]?((0,s.H)("duplicated_init_route_action",{action:o}),t):("Other"===n.pwtStaticContext.browserName&&!1===n.metricId.isAuthenticated&&"initial_app_load"===n.metricId.navigationType?((0,s.A9)(`TIMING.${o}`,{tags:{userAgent:null===(c=window)||void 0===c||null===(d=c.navigator)||void 0===d?void 0:d.userAgent}}),(0,s.A9)(`TIMING.sampled.${o}`,{tags:{userAgent:null===(p=window)||void 0===p||null===(m=p.navigator)||void 0===m?void 0:m.userAgent},sampleRate:.5})):((0,s.A9)(`TIMING.${o}`),(0,s.A9)(`TIMING.sampled.${o}`,{sampleRate:.5})),z({status:"TIMING",metricConfig:n,startTime:a,constraintMap:{},annotations:{},binaryAnnotations:{},imageTimings:[],isSampled:i,spans:[]},{constraint:Z}));var c,d,p,m})(t,e.payload);if("TIMING"!==t.status)return $(`ignoring action due to invalid state ${t.status}`,e),t;switch(e.type){case"ABORT":H(t,e.reason);const n={type:"ABORT",reason:e.reason};return{...t,status:"DONE",result:n};case"ANNOTATE":const{name:a}=e.payload;if(!P.Z)return t;const i=P.Z.now();return $(`adding annotation {${a}: ${i}}`),{...t,annotations:{...t.annotations,[a]:i}};case"BINARY_ANNOTATE":const{name:o,value:c,annotationType:d}=e.payload;return $(`adding binary annotation {${o}: ${c}}`),{...t,binaryAnnotations:{...t.binaryAnnotations,[o]:{value:c,type:d}}};case"MARK_CONSTRAINT_COMPLETE":return z(t,e.payload);case"REMOVE_CONSTRAINT":return((t,e)=>{if(!P.Z){const e=(0,r.KJ)(t.metricConfig.metricId);(0,s.H)("missing_window_performance",{action:e})}$(`removing constraint "${e}"`);const n=t.metricConfig.constraints.filter((t=>t!==e)),{[e]:a,...i}=t.constraintMap;return D({...t,constraintMap:i,metricConfig:{...t.metricConfig,constraints:n}})})(t,e.payload);case"SET_SEGMENT":return((t,e)=>{if(!P.Z){const e=(0,r.KJ)(t.metricConfig.metricId);(0,s.H)("missing_window_performance",{action:e})}$(`updating pwt segment to "${e}"`);const n={...t.metricConfig.metricId,segment:e};return{...t,metricConfig:{...t.metricConfig,metricId:n}}})(t,e.payload);case"SET_VISUALLY_COMPLETE_RESULT":{const{payload:{imageTimings:n}}=e;if(0===n.length){H(t,"visuallyComplete_noImages");const e={type:"ABORT",reason:"visuallyComplete_noImages"};return{...t,status:"DONE",result:e}}const a=Math.max(...n.map((t=>t.responseEnd||0)));return z({...t,imageTimings:n},{constraint:B,time:a})}case"ADD_SUBSPAN":const{startTime:p}=t,{payload:{name:m,startTime:l,endTime:u,annotations:g,binaryAnnotations:T,parentId:f}}=e;return{...t,spans:[...t.spans,{name:m,id:(0,v.Z)(),startTime:l||p,endTime:u,annotationMap:{...g},binaryAnnotationMap:{...T},parentId:f}]};case"START_SUBSPAN":return{...t,spans:[...t.spans,{name:e.payload.name,id:(0,v.Z)(),startTime:P.Z?P.Z.now():0,endTime:1/0,annotationMap:{...e.payload.annotations},binaryAnnotationMap:{...e.payload.binaryAnnotations},parentId:e.payload.parentId}]};case"STOP_SUBSPAN":const y=t.spans.findIndex((t=>t.name===e.payload.name));return y>-1?(t.spans[y].endTime=P.Z?P.Z.now():0,e.payload.annotations&&(t.spans[y].annotationMap={...t.spans[y].annotationMap,...e.payload.annotations}),e.payload.binaryAnnotations&&(t.spans[y].binaryAnnotationMap={...t.spans[y].binaryAnnotationMap,...e.payload.binaryAnnotations})):(0,s.H)("invalid_subspan_stop_name",{name:e.payload.name}),t;default:const A=(0,r.KJ)(t.metricConfig.metricId);return(0,s.H)("invalid_pwt_surface_action",{action:A}),t}},G=t=>{if(!t)return"initial_app_load";switch(t.action){case"PUSH":return"client_route_push";case"REPLACE":return"client_route_replace";default:return null}},F=({surface:t,constraints:e,segment:n,measureGridVisuallyComplete:r,annotateExperiments:o,customEnabledNavigationTypes:s,navigationInfo:{clientNavigation:c,navigationType:p},sampleRate:m})=>{const l=(0,a.useRef)("NOT_SET"),u=(0,d.N5)(),{getState:g,dispatch:T}=R(U,{status:"DISABLED",metricConfig:null});if(l.current!==c&&(l.current=c,u)){const{isAuthenticated:a}=u,i=t&&p&&(s||O).includes(p)?{metricId:{type:"surface",surface:t,navigationType:p,isAuthenticated:a,segment:n},annotateExperiments:o,constraints:[Z,...e||[],...r?[B]:[]],pwtStaticContext:u}:null;T({type:"INIT_ROUTE",payload:{metricConfig:i,startTime:c?c.time:0,isSampled:!m||Math.random()<m}})}const f=g();if((0,a.useEffect)((()=>{const t=t=>{T({type:"ABORT",reason:t})};i.Z.onSessionPause(t);const e=()=>{window.removeEventListener("resize",e),T({type:"ABORT",reason:"windowResized"})};return window.addEventListener("resize",e),()=>{const n=g();$("handling unmount",n),"TIMING"===n.status&&H(n,"unmount"),i.Z.removePauseListener(t),window.removeEventListener("resize",e)}}),[]),"TIMING"!==f.status||!f.constraintMap[Z])return{state:f,context:null};const{startTime:y,metricConfig:v}=f;return{state:f,context:{abort:t=>T({type:"ABORT",reason:t}),addAnnotation:t=>T({type:"ANNOTATE",payload:{name:t}}),addBinaryAnnotation:(t,e,n)=>T({type:"BINARY_ANNOTATE",payload:{name:t,value:e,annotationType:n}}),addSubspan:(t,e,n,a={},i={},r=null)=>T({type:"ADD_SUBSPAN",payload:{name:t,startTime:e,endTime:n,annotations:a,binaryAnnotations:i,parentId:r}}),getId:()=>y,getMetricId:()=>v.metricId,markConstraintComplete:t=>T({type:"MARK_CONSTRAINT_COMPLETE",payload:{constraint:t,time:P.Z?P.Z.now():0}}),removeConstraint:t=>T({type:"REMOVE_CONSTRAINT",payload:t}),setSegment:t=>T({type:"SET_SEGMENT",payload:t}),setVisuallyCompleteResult:v.constraints.includes(B)?t=>T({type:"SET_VISUALLY_COMPLETE_RESULT",payload:t}):null,startSubspan:(t,e={},n={},a=null)=>T({type:"START_SUBSPAN",payload:{name:t,annotations:e,binaryAnnotations:n,parentId:a}}),stopSubspan:(t,e={},n={},a=null)=>T({type:"STOP_SUBSPAN",payload:{name:t,annotations:e,binaryAnnotations:n,parentId:a}})}}},k=()=>{const t=(0,p.E)(),e=!!t;(0,a.useEffect)((()=>{if(e){const e=null==t?void 0:t.getMetricId(),n=e?(0,r.KJ)(e):null;(0,s.H)("nested_pwt_surface",{action:n})}}),[e])};function K({children:t,...e}){var n;const a=(0,d.fM)(),i=G(a),r=[...null!==(n=e.annotateExperiments)&&void 0!==n?n:[]],o={...e,annotateExperiments:r,navigationInfo:{navigationType:i,clientNavigation:a}},{context:s}=F(o);return k(),(0,x.jsx)(p.S,{value:s,children:t})}},311560:(t,e,n)=>{n.d(e,{Z:()=>a});const a=t=>{switch(t){case"BR":case"MX":case"AR":case"CL":case"CO":return"LatAm";case"US":return"US";case"CA":return"CA";case"GB":return"GB";case"FR":return"FR";case"DE":return"DE";default:return"OTHER"}}}}]);
//# sourceMappingURL=https://sm.pinimg.com/webapp/97687-3be6e414546d720a.mjs.map